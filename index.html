<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인터랙티브 캘린더</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        .date-cell:hover .add-task-in-cell-btn {
            opacity: 1;
        }
        .task-in-calendar:hover .delete-task-in-cell-btn,
        .task-in-calendar:hover .postpone-task-btn {
             opacity: 1;
        }
        .calendar-tasks {
            max-height: calc(100% - 2.5rem);
        }
        .calendar-tasks::-webkit-scrollbar {
            width: 4px;
        }
        .calendar-tasks::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 20px;
        }
        .task-in-calendar label {
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        
        <!-- Year View -->
        <div id="year-view">
            <div class="flex items-center justify-between mb-6 bg-white p-4 rounded-2xl shadow-lg">
                <button id="prev-year-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <h2 id="current-year" class="text-2xl sm:text-3xl font-bold text-gray-800"></h2>
                <button id="next-year-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div id="month-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <!-- Month buttons generated by JS -->
            </div>
        </div>

        <!-- Month View (initially hidden) -->
        <div id="month-view" class="hidden">
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                <div class="flex items-center justify-between mb-4">
                    <button id="back-to-year-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors duration-200 flex items-center text-sm font-semibold text-gray-600">
                        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8a5 5 0 000-10H6"></path></svg>
                        연도 보기
                    </button>
                    <div class="flex items-center">
                        <button id="prev-month-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>
                        <h2 id="current-month-year" class="text-xl sm:text-2xl font-bold text-gray-800 w-48 text-center"></h2>
                        <button id="next-month-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors duration-200">
                            <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                    </div>
                    <div class="w-28"></div> <!-- Spacer for alignment -->
                </div>

                <div class="grid calendar-grid gap-px bg-gray-200 border border-gray-200 rounded-lg overflow-hidden">
                    <div class="text-center font-semibold text-red-500 py-2 bg-white">일</div>
                    <div class="text-center font-semibold text-gray-600 py-2 bg-white">월</div>
                    <div class="text-center font-semibold text-gray-600 py-2 bg-white">화</div>
                    <div class="text-center font-semibold text-gray-600 py-2 bg-white">수</div>
                    <div class="text-center font-semibold text-gray-600 py-2 bg-white">목</div>
                    <div class="text-center font-semibold text-gray-600 py-2 bg-white">금</div>
                    <div class="text-center font-semibold text-blue-500 py-2 bg-white">토</div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Views
        const yearView = document.getElementById('year-view');
        const monthView = document.getElementById('month-view');
        
        // Year View Elements
        const prevYearBtn = document.getElementById('prev-year-btn');
        const nextYearBtn = document.getElementById('next-year-btn');
        const currentYearEl = document.getElementById('current-year');
        const monthGrid = document.getElementById('month-grid');

        // Month View Elements
        const backToYearBtn = document.getElementById('back-to-year-btn');
        const calendarGrid = document.querySelector('.calendar-grid');
        const currentMonthYearEl = document.getElementById('current-month-year');
        const prevMonthBtn = document.getElementById('prev-month-btn');
        const nextMonthBtn = document.getElementById('next-month-btn');

        // State
        let currentDate = new Date();
        let displayedYear = new Date().getFullYear();
        let selectedDate = formatDate(new Date());
        let tasks = JSON.parse(localStorage.getItem('calendarTasks')) || {};

        // --- View Switching ---
        function showYearView() {
            yearView.classList.remove('hidden');
            monthView.classList.add('hidden');
        }

        function showMonthView() {
            monthView.classList.remove('hidden');
            yearView.classList.add('hidden');
        }

        // --- Year View Logic ---
        function renderYearView() {
            showYearView();
            currentYearEl.textContent = `${displayedYear}년`;
            monthGrid.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                const monthBtn = document.createElement('button');
                monthBtn.textContent = `${i + 1}월`;
                monthBtn.dataset.month = i;
                monthBtn.className = 'text-lg font-semibold p-6 bg-white rounded-xl shadow hover:bg-blue-50 hover:ring-2 hover:ring-blue-500 transition-all duration-200';
                
                monthBtn.addEventListener('click', () => {
                    currentDate = new Date(displayedYear, i, 1);
                    renderMonthView();
                    showMonthView();
                });
                monthGrid.appendChild(monthBtn);
            }
        }

        // --- Month View Logic ---
        function renderMonthView() {
            renderCalendar();
        }
        
        // --- Event Delegation for Calendar Grid ---
        calendarGrid.addEventListener('click', (e) => {
            const target = e.target;
            if (target.closest('.add-task-in-cell-btn')) {
                const cell = target.closest('.date-cell');
                addInlineTaskInput(cell, cell.dataset.date);
                return;
            }
            if (target.closest('.delete-task-in-cell-btn')) {
                const { date, index } = target.closest('.delete-task-in-cell-btn').dataset;
                if(tasks[date] && tasks[date][index]) {
                    tasks[date].splice(index, 1);
                    saveAndRender();
                }
                return;
            }
            if (target.closest('.postpone-task-btn')) {
                const { date, index } = target.closest('.postpone-task-btn').dataset;
                const taskToPostpone = tasks[date].splice(parseInt(index), 1)[0];
                const tomorrow = new Date(date);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = formatDate(tomorrow);
                if (!tasks[tomorrowStr]) tasks[tomorrowStr] = [];
                tasks[tomorrowStr].push(taskToPostpone);
                saveAndRender();
                return;
            }
            const cell = target.closest('.date-cell');
            if (cell && !target.closest('input, label, .inline-task-input')) {
                selectedDate = cell.dataset.date;
                renderCalendar();
            }
        });

        calendarGrid.addEventListener('change', (e) => {
            if (e.target.matches('.task-in-calendar input[type="checkbox"]')) {
                const { date, index } = e.target.dataset;
                if (tasks[date] && tasks[date][index] !== undefined) {
                    tasks[date][index].completed = e.target.checked;
                    saveAndRender();
                }
            }
        });
        
        function addInlineTaskInput(cell, date) {
            if (cell.querySelector('.inline-task-input')) return;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'inline-task-input text-xs w-full border border-blue-300 rounded px-1 py-0.5 mt-1';
            input.placeholder = '일정 입력 후 Enter';
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && input.value.trim()) {
                    addTask(input.value.trim(), date);
                    input.remove();
                } else if (e.key === 'Escape') {
                    input.remove();
                }
            });
            input.addEventListener('blur', () => input.remove());
            cell.querySelector('.calendar-tasks').appendChild(input);
            input.focus();
        }

        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function renderCalendar() {
            while (calendarGrid.children.length > 7) {
                calendarGrid.removeChild(calendarGrid.lastChild);
            }
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            currentMonthYearEl.textContent = `${year}년 ${month + 1}월`;
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDayOfMonth; i++) {
                const blankCell = document.createElement('div');
                blankCell.className = 'bg-gray-50';
                calendarGrid.appendChild(blankCell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateCell = document.createElement('div');
                const dateStr = formatDate(new Date(year, month, day));
                dateCell.className = `date-cell relative bg-white p-2 h-32 sm:h-40 flex flex-col cursor-pointer hover:bg-gray-50 transition-colors duration-200`;
                dateCell.dataset.date = dateStr;

                const header = document.createElement('div');
                header.className = 'flex items-center justify-between';
                const dateNumber = document.createElement('span');
                dateNumber.className = 'date-number font-medium';
                dateNumber.textContent = day;
                header.appendChild(dateNumber);
                const addButton = document.createElement('button');
                addButton.className = 'add-task-in-cell-btn opacity-0 text-blue-500 hover:text-blue-700 transition-opacity';
                addButton.innerHTML = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>`;
                header.appendChild(addButton);
                dateCell.appendChild(header);

                const todayStr = formatDate(new Date());
                if (dateStr === todayStr) dateNumber.classList.add('bg-blue-600', 'text-white', 'rounded-full', 'w-7', 'h-7', 'flex', 'items-center', 'justify-center');
                if (dateStr === selectedDate) dateCell.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
                
                const tasksContainer = document.createElement('div');
                tasksContainer.className = 'calendar-tasks flex-grow overflow-y-auto pr-1 text-left mt-1';
                dateCell.appendChild(tasksContainer);

                const dayTasks = tasks[dateStr] || [];
                dayTasks.forEach((task, index) => {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'task-in-calendar text-xs flex items-start justify-between mb-1 group';
                    const taskId = `cal-task-${dateStr}-${index}`;
                    const isToday = dateStr === todayStr;
                    let postponeButtonHTML = (isToday && !task.completed) ? `<button class="postpone-task-btn opacity-0 group-hover:opacity-100 text-blue-400 hover:text-blue-600 flex-shrink-0 mx-1" data-date="${dateStr}" data-index="${index}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></button>` : '';
                    taskEl.innerHTML = `
                        <div class="flex items-start flex-grow min-w-0">
                            <input type="checkbox" id="${taskId}" data-date="${dateStr}" data-index="${index}" class="mt-0.5 mr-1.5 flex-shrink-0 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" ${task.completed ? 'checked' : ''}>
                            <label for="${taskId}" class="break-words ${task.completed ? 'line-through text-gray-400' : ''}">${task.text}</label>
                        </div>
                        <div class="flex items-center flex-shrink-0">
                            ${postponeButtonHTML}
                            <button class="delete-task-in-cell-btn opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-600 flex-shrink-0" data-date="${dateStr}" data-index="${index}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
                        </div>`;
                    tasksContainer.appendChild(taskEl);
                });
                calendarGrid.appendChild(dateCell);
            }
        }

        function addTask(taskText, dateStr) {
            if (!tasks[dateStr]) tasks[dateStr] = [];
            tasks[dateStr].push({ text: taskText, completed: false });
            saveAndRender();
        }
        
        function saveAndRender() {
            localStorage.setItem('calendarTasks', JSON.stringify(tasks));
            renderCalendar();
        }

        // --- Initial Setup & Event Listeners ---
        prevYearBtn.addEventListener('click', () => { displayedYear--; renderYearView(); });
        nextYearBtn.addEventListener('click', () => { displayedYear++; renderYearView(); });
        backToYearBtn.addEventListener('click', renderYearView);

        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });
        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        renderYearView(); // Initial view
    });
    </script>
</body>
</html>

